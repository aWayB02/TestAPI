# Объяснение компонентов MVC с примерами из проекта To-Do List

## 1. Model (Модель) - `models/todo.py`

**Что это:** Модель - это как "карточка" с информацией о задаче. Это самая простая часть, которая описывает, как выглядит задача.

**Пример из жизни:** Как анкета, где вы заполняете имя, фамилию, возраст.

**В нашем проекте:**
```python
class Todo:
    def __init__(self, title, description):
        self.title = title          # Название задачи, например "Купить молоко"
        self.description = description  # Описание, например "В магазине Пятерочка"
        self.completed = False     # Выполнена ли задача (по умолчанию False)
        self.created_at = datetime.now()  # Когда создали задачу
```

**Что умеет делать:**
- `to_dict()` - превращает задачу в JSON формат для отправки пользователю
- `mark_completed()` - помечает задачу как выполненную
- `update()` - обновляет название или описание

**Пример использования:**
```python
# Создаем задачу
todo = Todo(title="Купить молоко", description="В магазине Пятерочка")

# Помечаем как выполненную
todo.mark_completed()

# Отправляем пользователю в понятном формате
result = todo.to_dict()
# Получаем: {"title": "Купить молоко", "completed": true, ...}
```

## 2. View (Представление) - JSON ответы

**Что это:** View - это как красивая упаковка, в которой мы отдаем данные пользователю.

**Пример из жизни:** Как подарочная коробка, в которой красиво упакован подарок.

**В нашем проекте:**
Когда пользователь просит список задач, мы упаковываем их в красивый JSON:

```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "title": "Купить молоко",
      "description": "В магазине Пятерочка",
      "completed": false,
      "created_at": "2026-02-22T10:00:00Z"
    }
  ]
}
```

**Почему важно:**
- Пользователь получает данные в понятном формате
- Все ответы имеют одинаковую структуру
- Легко понять, успешно ли прошел запрос

## 3. Controller (Контроллер) - `api/todo_api.py`

**Что это:** Контроллер - это как "портier" в отеле. Он принимает гостей (запросы), проверяет что все в порядке, и отправляет к нужному специалисту.

**Пример из жизни:** Как администратор в ресторане, который принимает заказ и передает его поварам.

**В нашем проекте:**
```python
@router.post("/")  # Когда приходит POST запрос на /api/v1/todos
async def create_todo(todo_data: dict, service: TodoService = Depends(get_todo_service)):
    # 1. Контроллер принимает данные от пользователя
    title = todo_data.get("title")
    
    # 2. Проверяет что все в порядке
    if not title:
        raise HTTPException(status_code=400, detail="Нужно указать название задачи")
    
    # 3. Передает работу сервису
    todo = service.create_todo(title, todo_data.get("description"))
    
    # 4. Упаковывает результат красиво и отправляет пользователю
    return {"status": "success", "data": todo.to_dict()}
```

**Что делает контроллер:**
- Принимает запросы от пользователя
- Проверяет что данные пришли правильно
- Передает работу сервису
- Отправляет красивый ответ пользователю

## 4. Repository (Репозиторий) - `repositories/todo_repository.py`

**Что это:** Репозиторий - это как "библиотекарь", который знает как работать с базой данных.

**Пример из жизни:** Как библиотекарь, который знает где лежит каждая книга и как их находить.

**В нашем проекте:**
```python
def create(self, todo: Todo) -> Todo:
    # 1. Превращает нашу "карточку" в запись базы данных
    db_todo = TodoDB(
        title=todo.title,
        description=todo.description,
        completed=todo.completed
    )
    
    # 2. Сохраняет в базу данных
    self.db.add(db_todo)
    self.db.commit()
    self.db.refresh(db_todo)
    
    # 3. Возвращает сохраненную задачу
    return Todo(
        id=db_todo.id,
        title=db_todo.title,
        description=db_todo.description,
        completed=db_todo.completed
    )
```

**Что умеет делать:**
- `create()` - создать новую задачу
- `get_by_id()` - найти задачу по номеру
- `get_all()` - получить все задачи
- `update()` - обновить задачу
- `delete()` - удалить задачу

## 5. Service (Сервис) - `services/todo_service.py`

**Что это:** Сервис - это как "инспектор качества", который проверяет что все правильно сделано.

**Пример из жизни:** Как учитель, который проверяет домашнее задание перед тем как поставить оценку.

**В нашем проекте:**
```python
def create_todo(self, title: str, description: Optional[str] = None) -> Todo:
    # 1. Проверяет что название не пустое
    if not title or not title.strip():
        raise ValueError("Название задачи не может быть пустым")
    
    # 2. Проверяет что название не слишком длинное
    if len(title.strip()) > 255:
        raise ValueError("Название задачи не может быть длиннее 255 символов")
    
    # 3. Создает задачу
    todo = Todo(title=title.strip(), description=description)
    
    # 4. Передает репозиторию для сохранения
    return self.repository.create(todo)
```

**Что делает сервис:**
- Проверяет (валидирует) данные
- Содержит бизнес-логику (правила работы приложения)
- Координирует работу между компонентами
- Обрабатывает ошибки

## Как все компоненты работают вместе - Пример

**Когда пользователь хочет создать задачу:**

1. **Пользователь** отправляет запрос:
   ```
   POST /api/v1/todos
   {
     "title": "Купить молоко",
     "description": "В магазине Пятерочка"
   }
   ```

2. **Controller** (`api/todo_api.py`):
   - Принимает запрос
   - Проверяет что данные есть
   - Передает работу сервису

3. **Service** (`services/todo_service.py`):
   - Проверяет что название не пустое
   - Проверяет длину названия
   - Создает объект Todo
   - Передает репозиторию

4. **Repository** (`repositories/todo_repository.py`):
   - Сохраняет задачу в базу данных
   - Возвращает сохраненную задачу

5. **Controller**:
   - Упаковывает задачу в красивый JSON
   - Отправляет ответ пользователю

**Результат для пользователя:**
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "title": "Купить молоко",
    "description": "В магазине Пятерочка",
    "completed": false,
    "created_at": "2026-02-22T10:00:00Z"
  }
}
```

## Почему такая структура удобна?

1. **Каждый делает свое дело:**
   - Модель: описывает как выглядит задача
   - Контроллер: принимает и отправляет запросы
   - Сервис: проверяет и обрабатывает данные
   - Репозиторий: работает с базой данных

2. **Легко тестировать:**
   - Можно проверить каждый компонент отдельно
   - Если что-то сломается, сразу понятно где искать

3. **Легко менять:**
   - Если поменяем базу данных, сервис не изменится
   - Если поменяем способ отправки ответов, модель не изменится

4. **Легко понимать:**
   - Четкая структура, как в книге с оглавлением
   - Каждый файл имеет свое назначение